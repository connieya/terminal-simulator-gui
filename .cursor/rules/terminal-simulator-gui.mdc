# Terminal Simulator GUI 프로젝트 규칙

## 프로젝트 개요
- **위치**: `/Users/cony/Desktop/snowoncard/my-simulator/terminal-simulator-gui`
- **기술 스택**: Electron, React 19, TypeScript, Vite, TailwindCSS, Zustand
- **역할**: 교통 단말기 관리 GUI 애플리케이션
- **포트**: 
  - Vite Dev Server: 5175
  - Java Terminal Simulator 연결: TCP 9999 (클라이언트)

## 프로젝트 구조

### Electron 계층 (`electron/`)
- **main.ts**: Electron Main Process
  - 브라우저 윈도우 생성 및 관리
  - IPC 핸들러 등록
  - TCP 클라이언트 초기화 및 관리
- **preload.ts**: Preload Script
  - Renderer Process와 Main Process 간 IPC 브릿지
  - 보안을 위한 Context Isolation 설정
- **tcpClient.ts**: TCP 클라이언트
  - Java Terminal Simulator와 TCP 통신 (포트 9999)
  - 명령어 전송 및 응답 수신
  - 재연결 로직 포함

### React 컴포넌트 (`src/components/`)
- **TerminalList.tsx**: 단말기 목록 관리
  - 단말기 카드 목록 표시
  - 단말기 상태 관리 (전원, 연결 상태 등)
- **TerminalCard.tsx**: 개별 단말기 카드
  - 단말기 정보 표시
  - 카드 탭 버튼 등 액션 제공
- **CardTapButton.tsx**: 카드 탭 버튼
  - 카드 탭 시뮬레이션 트리거
- **ConnectionSettings.tsx**: 연결 설정
  - TCP 연결 설정 (호스트, 포트)
  - 연결/연결 해제 버튼
- **TcpConnectionPanel.tsx**: TCP 연결 패널
  - 연결 상태 표시
  - 연결 관리 UI
- **Toast.tsx**: 토스트 알림 컴포넌트

### 상태 관리 (`src/stores/`)
- **terminalStore.ts**: Zustand 스토어
  - 단말기 목록 상태 관리
  - 단말기 상태 업데이트
  - 연결 상태 관리

### 컨텍스트 (`src/contexts/`)
- **ToastContext.tsx**: 토스트 알림 컨텍스트
  - 전역 토스트 알림 관리

### 공유 타입 (`shared/`)
- **types.ts**: TypeScript 타입 정의
  - `TerminalCommand`: 단말기 명령 타입
  - `TerminalInfo`: 단말기 정보 타입
  - `TcpConnectionConfig`: TCP 연결 설정 타입
  - `TerminalResponse`: 응답 타입

### 유틸리티 (`src/utils/`)
- **tcpClient.ts**: TCP 클라이언트 유틸리티 (Renderer Process용)
  - IPC를 통한 Main Process와 통신

## 주요 기능
1. **단말기 관리**: 여러 교통 단말기 목록 표시 및 관리
2. **카드 탭 시뮬레이션**: GUI에서 카드 탭 트리거
3. **연결 관리**: Java Terminal Simulator와 TCP 연결 설정 및 관리
4. **상태 모니터링**: 단말기 상태 및 연결 상태 실시간 표시
5. **명령 전송**: 단말기 제어 명령 전송 (signon, signoff, sync, card_tap 등)

## 지원하는 명령어
- `signon`: 단말기 전원 켜기
- `signoff`: 단말기 전원 끄기
- `sync`: 단말기 동기화 (승차/하차, 역 정보 포함)
- `card_tap`: 카드 탭 시뮬레이션
- `echo-test`: 에코 테스트
- `status`: 상태 확인
- `ping`: 핑 테스트
- `reset`: 리셋

## 통신 흐름
1. **GUI 사용자 액션** → React 컴포넌트에서 IPC 호출
2. **IPC 통신** → Preload Script를 통해 Main Process로 전달
3. **TCP 통신** → Main Process의 TcpClient가 Java Terminal Simulator (포트 9999)에 명령 전송
4. **응답 수신** → TCP 응답을 IPC를 통해 Renderer Process로 전달
5. **UI 업데이트** → Zustand 스토어 업데이트 및 컴포넌트 리렌더링

## 명령어 변환 로직
`tcpClient.ts`의 `commandToCliString()` 메서드에서 GUI 명령어를 Java Terminal Simulator CLI 명령어로 변환:
- `card_tap` → `authorization-tps subway_{in|out}_{역이름}`
- `sync` → `sync-tms subway_{in|out}_{역이름}`
- `signon` → `signon-tps`
- `signoff` → `signoff-tps`
- 등등...

## 개발 모드 실행
```bash
npm run dev
```
- Vite dev server 시작 (포트 5175)
- Electron Main Process 빌드 및 실행
- Hot Module Replacement 지원

## 빌드
```bash
npm run build
```
- TypeScript 컴파일
- Vite 빌드
- Electron 빌드

## 개발 가이드라인
1. **타입 안전성**: 모든 IPC 통신은 타입 정의 사용 (`shared/types.ts`)
2. **상태 관리**: 전역 상태는 Zustand 스토어 사용
3. **스타일링**: TailwindCSS 사용, `lib/utils.ts`의 `cn()` 함수로 클래스 병합
4. **에러 처리**: 모든 TCP 통신 에러는 Toast로 표시
5. **재연결**: TCP 연결 끊김 시 자동 재연결 (3초 간격)
6. **응답 파싱**: JSON 또는 텍스트 응답 모두 지원
7. **컴포넌트 구조**: 재사용 가능한 컴포넌트로 분리

## 설정
- **TCP 연결 기본값**: localhost:9999
- **연결 타임아웃**: 5초
- **재연결 간격**: 3초
- **명령 타임아웃**: 10초

## 주요 의존성
- **electron**: 데스크톱 애플리케이션 프레임워크
- **react/react-dom**: UI 라이브러리
- **zustand**: 상태 관리
- **tailwindcss**: CSS 프레임워크
- **vite**: 빌드 도구 및 dev server

## 향후 확장 계획
- Java Terminal Simulator의 GUI 서버 기능 추가 시 완전한 양방향 통신 지원
- 실시간 로그 표시 기능
- 단말기 설정 관리 기능
- 배치 명령 실행 기능
